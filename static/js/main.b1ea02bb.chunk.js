(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{375:function(e,t,n){e.exports=n(896)},380:function(e,t,n){},896:function(e,t,n){"use strict";n.r(t);var a=n(64),o=n(65),r=n(67),i=n(66),c=n(68),s=n(1),l=n.n(s),u=n(7),d=(n(380),n(116)),h=function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.createElement(d.Spin,{size:"large",className:"absoluteCenter"})}}]),t}(s.Component),p=function(e){return e.body.getReader().read().then(function(e){return e})},m=new Audio,g=function(e){var t=new Blob([e.value],{type:"audio/mp3"}),n=window.URL.createObjectURL(t);m.src=n,m.play()},f=n(907),v=function(e){function t(e){var n;return Object(a.a)(this,t),n=Object(r.a)(this,Object(i.a)(t).call(this,e)),fetch(n.props.lyricsFile).then(function(e){return e.json()}).then(function(e){n.setState({lyrics:e}),console.log(e)}),n.state={lyrics:void 0,t:0},n}return Object(c.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;requestAnimationFrame(function t(){var n=window.performance.now()-e.props.tStart;e.setState({t:2*n}),requestAnimationFrame(t)})}},{key:"render",value:function(){var e=this.state,t=e.lyrics,n=e.t;if(!t)return l.a.createElement("div",null);var a=t.slice().reverse().find(function(e){return e.start<n});if(!a)return l.a.createElement("div",null);var o=[a];return t.indexOf(a)<t.length-1&&o.push(t[t.indexOf(a)+1]),l.a.createElement("div",{className:"lines-div"},o.map(function(e,t){var o=e.records.find(function(t){return t.delta+e.start-1500>=n});return l.a.createElement("div",{className:"lyrics-line-div"},l.a.createElement("span",{className:"lyrics-line"},e.text,l.a.createElement("div",{className:"lyrics-highlight",style:{width:o&&e===a?"".concat(100*o.index/e.text.length,"%"):"0px"}})))}))}}]),t}(l.a.Component),y=d.Typography.Title,b=d.Typography.Text,E="".concat("https://4d67ebce.ngrok.io",":").concat(Object({NODE_ENV:"production",PUBLIC_URL:"/tamouya-gouli",REACT_APP_SERVER_IP:"https://4d67ebce.ngrok.io"}).REACT_APP_SERVER_PORT?Object({NODE_ENV:"production",PUBLIC_URL:"/tamouya-gouli",REACT_APP_SERVER_IP:"https://4d67ebce.ngrok.io"}).REACT_APP_SERVER_PORT:"");console.log(E);var S=function(e){function t(e){var n;Object(a.a)(this,t),(n=Object(r.a)(this,Object(i.a)(t).call(this,e))).refSoumah=void 0,n.audioReady=!1,n.bgAudio=new Audio,n.pointerLocation=void 0,n.handleServerError=function(e){console.error(e),console.log("Server offline?"),n.setState({serverState:"offline"})},n.first=!0,n.onAnyClick=function(){n.first&&(m.play(),n.bgAudio.play(),n.first=!1)},n.avatars=[{scale:1,src:["momo.png","leye.png","reye.png"]}],n.connect(),n.refSoumah=s.createRef();return requestAnimationFrame(function e(){void 0===n.state.bgAudioStart&&n.bgAudio.currentTime>0&&n.setState({bgAudioStart:window.performance.now()}),n.setState({t:window.performance.now()}),requestAnimationFrame(e)}),n.bgAudio.addEventListener("canplay",function(){n.audioReady=!0}),n.bgAudio.addEventListener("ended",function(){n.setState({bgAudioStart:void 0})}),n.bgAudio.src="tamouya_gouli.mp3",n.state={serverState:"loading",applicationState:void 0,unsupportedLanguageCodes:void 0,t:window.performance.now()},n}return Object(c.a)(t,e),Object(o.a)(t,[{key:"connect",value:function(){var e=this;fetch(E+"/u-there",{mode:"cors"}).then(function(e){return e.text()}).then(function(t){"we here"===t&&(console.log("Server online"),e.setState({serverState:"online"}),e.getApplicationState())}).catch(this.handleServerError)}},{key:"getApplicationState",value:function(){var e=this;fetch(E+"/state",{mode:"cors"}).then(function(e){return e.json()}).then(function(t){e.setState({applicationState:t}),e.sortUnsupportedTextToSpeech()}).catch(this.handleServerError)}},{key:"sortUnsupportedTextToSpeech",value:function(){var e=this;fetch(E+"/unsupported-languages-text-to-speech",{mode:"cors"}).then(function(e){return e.json()}).then(function(t){console.log(t),e.setState({unsupportedLanguageCodes:t.map(function(e){return e.languageCode})})}).catch(this.handleServerError)}},{key:"playResultSound",value:function(e){this.onAnyClick(),fetch(E+"/text-to-speech?text=".concat(e.local,"&languageCode=").concat(e.language.Code)).then(p).then(g).catch(function(e){console.error(e)})}},{key:"componentDidMount",value:function(){var e,t=this;!function n(){requestAnimationFrame(n),void 0===t.state.bgAudioStart||e||(e=window.performance.now());for(var a=document.getElementsByClassName("soumah"),o=0;o<a.length;o++){var r=a[o],i=r.getAttribute("index"),c=r.getAttribute("scale"),s=e?2*(window.performance.now()+1500*i-e)/1e3:0,l=5*Math.sin(s)-10,u=12*Math.sin(s),d=1+.15*Math.sin(2*s),h=150*Math.sin(s)-90,p=50+100*Math.abs(Math.sin(s)),m="";if(m+="translateX(".concat(h,"px) translateY(").concat(p,"px) "),m+="skewX(".concat(0,"deg) skewY(").concat(u,"deg) "),m+="rotateX(".concat(0,"deg) rotateY(").concat(0,"deg) rotateZ(").concat(l,"deg) "),m+="scaleX(".concat(d,") scaleY(").concat(d,") "),c&&(m+="scaleX(".concat(c,") scaleY(").concat(c,") ")),"src"in r&&r.src.includes("eye.png")){var g=0,f=0,v=r.src.includes("leye.png"),y=Math.PI*(l+100)/180,b={x:.5*window.innerWidth+10*(v?1:-1)-Math.cos(y)*r.width,y:window.innerHeight-Math.sin(y)*r.height*.7};if(t.pointerLocation){var E={x:t.pointerLocation.x-b.x,y:t.pointerLocation.y-b.y},S=Math.sqrt(Math.pow(E.x,2)+Math.pow(E.y,2)),A=Math.min(1*Math.sqrt(S),5),w=Math.atan2(t.pointerLocation.y-b.y,t.pointerLocation.x-b.x);g=Math.cos(w)*A,f=Math.sin(w)*A}m+="translateX(".concat(g,"px) translateY(").concat(f,"px) ")}r.style.transform=m}}(),document.addEventListener("mousemove",function(e){t.pointerLocation={x:e.clientX,y:e.clientY}},!0),document.addEventListener("touchmove",function(e){0!==e.changedTouches.length&&(t.pointerLocation={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY})},!0)}},{key:"render",value:function(){var e=this,t=this.state.t,n=void 0!==this.state.bgAudioStart&&t-this.state.bgAudioStart>=232e3&&t-this.state.bgAudioStart<=334e3,a=void 0!==this.state.bgAudioStart&&t-this.state.bgAudioStart>=117e3&&t-this.state.bgAudioStart<=18e4,o=this.state.serverState;return s.createElement("div",{className:"expand",onClick:function(){return e.onAnyClick()}},s.createElement("div",{className:"backgroundDiv",onClick:function(){return e.onAnyClick()}},s.createElement("img",{className:"background",src:"background.png"}),this.avatars.map(function(t,a){var o={scale:t.scale,index:a};return t.src.map(function(t,r){return s.createElement("img",Object.assign({key:a+"a"+r,className:"soumah",src:n&&"momo.png"===t?"momo_flute.png":t},o,{onClick:function(){return e.onAnyClick()}}))})}),this.state.bgAudioStart&&s.createElement("div",{className:"lyrics-div"},s.createElement(v,{lyricsFile:"lyrics.json",tStart:this.state.bgAudioStart}))),a&&this.renderXylophoneStick(t,!1),a&&this.renderXylophoneStick(t,!0),a&&s.createElement("img",{style:{position:"absolute",bottom:0,right:"35vw"},src:"xylophone.png"}),"loading"===o?s.createElement(h,null):s.createElement("div",{className:"main"},"offline"===o?s.createElement(b,null):this.renderServerOnline()))}},{key:"renderXylophoneStick",value:function(e,t){var n=(e=t?e:e+120)%120/120;return e%240<=120||(n=1-n),s.createElement("img",{src:"xylophone_stick.png",className:"backgroundElement",style:{bottom:"".concat(t?0:60,"px"),left:"calc(50vw + ".concat(t?150:-300,"px)"),transform:"rotateZ(".concat(n*(t?-90:90),"deg)"),transformOrigin:"bottom"}})}},{key:"renderServerOnline",value:function(){var e=this.state.applicationState;return s.createElement("div",null,e&&this.renderApplicationState(e))}},{key:"renderApplicationState",value:function(e){var t=this,n=this.state.unsupportedLanguageCodes,a=e.inputLanguage,o=e.input,r=e.results,i=function(e){return void 0===n||!n.includes(e.language.Code)},c=r.filter(i).concat(r.filter(function(e){return!i(e)}));return s.createElement("div",{className:"column",style:{display:"none"}},s.createElement(y,{level:3},"Official translations for..."),s.createElement("div",{className:"row listStart"},s.createElement(b,{className:"speechAsText"},'"',o,'"')),c.map(function(e,n){return s.createElement("div",{className:"row",key:n},s.createElement(b,null,e.language.Name,":"),s.createElement(b,{className:"speechAsText"},e.local),i(e)&&s.createElement(f.a,{onClick:function(){return t.playResultSound(e)}}),a===e.language&&s.createElement(b,null,"(",e.translation,")"))}))}}]),t}(s.Component),A=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(r.a)(this,Object(i.a)(t).call(this,e))).state={},n}return Object(c.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.createElement(S,null)}}]),t}(s.Component),w=document.getElementById("root");Object(u.render)(s.createElement(A,null),w)}},[[375,2,1]]]);
//# sourceMappingURL=main.b1ea02bb.chunk.js.map
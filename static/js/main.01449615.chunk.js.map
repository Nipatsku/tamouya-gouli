{"version":3,"sources":["Components/Common/Loading.tsx","audio.ts","Components/Lyrics.tsx","Components/MainMenu/MainMenu.tsx","index.tsx"],"names":["Loading","_React$Component","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","apply","arguments","inherits","createClass","key","value","react","lib","size","className","React","readAudioStream","res","body","getReader","read","then","result","audio","Audio","playAudioStream","blob","Blob","type","url","window","URL","createObjectURL","src","play","LyricsComponent","props","_this","call","fetch","lyricsFile","r","json","lyrics","setState","console","log","state","undefined","t","_this2","requestAnimationFrame","setTime","performance","now","tStart","_this$state","react_default","a","createElement","firstShownLine","slice","reverse","find","line","start","lines","indexOf","length","push","map","i","refRecord","records","record","delta","text","style","width","concat","index","Component","Title","Typography","Text","SERVER_ADDRESS","process","REACT_APP_SERVER_PORT","MainMenu","refSoumah","audioReady","bgAudio","pointerLocation","handleServerError","e","error","serverState","first","onAnyClick","avatars","scale","connect","check","bgAudioStart","currentTime","addEventListener","applicationState","unsupportedLanguageCodes","mode","response","getApplicationState","catch","_this3","sortUnsupportedTextToSpeech","_this4","unsupportedLanguages","obj","languageCode","local","language","Code","_this5","animate","objects","document","getElementsByClassName","soumah","attr_index","getAttribute","attr_scale","rotateZ","Math","sin","skewY","translateX","translateY","abs","transform","includes","addX","addY","isLeft","ang","PI","ref","x","innerWidth","cos","y","innerHeight","height","dist","sqrt","pow","eyeOffset","min","deltaAng","atan2","clientX","clientY","changedTouches","_this6","isFlute","isXylophone","onClick","avatar","i2","assign","Lyrics_LyricsComponent","renderXylophoneStick","position","bottom","right","Loading_Loading","renderServerOnline","left","transformOrigin","renderApplicationState","_this7","inputLanguage","input","results","isResultSupported","sortedResults","filter","level","Name","SoundOutlined","playResultSound","translation","App","MainMenu_MainMenu","rootElement","getElementById","render","src_App"],"mappings":"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","file":"static/js/main.01449615.chunk.js","sourcesContent":["import * as React from \"react\";\r\nimport { Spin } from \"antd/lib\"\r\n\r\ninterface Props {}\r\ninterface State {}\r\nexport class Loading extends React.Component<Props, State> {\r\n    render() {\r\n        return <Spin\r\n            size=\"large\"\r\n            className=\"absoluteCenter\"\r\n        />\r\n    }\r\n}\r\n","\r\n// https://medium.com/@bitshadow/play-audio-via-react-fetch-post-request-92a901d0bb7f\r\n\r\nexport const readAudioStream = ( res: Response ) => {\r\n    const reader = res.body!.getReader()\r\n    return reader\r\n        .read()\r\n        .then((result) => {\r\n            return result;\r\n        });\r\n}\r\n\r\nexport const audio = new Audio()\r\nexport const playAudioStream = ( res: ReadableStreamReadResult<Uint8Array> ) => {\r\n    const blob = new Blob([res.value!], { type: 'audio/mp3' });\r\n    const url = window.URL.createObjectURL(blob)\r\n    audio.src = url;\r\n    audio.play();\r\n}\r\n","import React from 'react'\r\nimport { Lyrics } from '../Components/LyricsGenerator/LyricsGenerator'\r\n\r\ninterface Props {\r\n    lyricsFile: string\r\n    tStart: number\r\n}\r\ninterface State {\r\n    lyrics?: Lyrics,\r\n    t: number\r\n}\r\nexport class LyricsComponent extends React.Component<Props, State> {\r\n\r\n    constructor(props: Props) {\r\n        super(props)\r\n        fetch(this.props.lyricsFile)\r\n            .then(r => r.json())\r\n            .then((lyrics: Lyrics) => {\r\n                this.setState({ lyrics })\r\n                console.log(lyrics)\r\n            })\r\n        this.state = {\r\n            lyrics: undefined,\r\n            t: 0\r\n        }\r\n    }\r\n    componentDidMount() {\r\n        const setTime = () => {\r\n            const t = window.performance.now() - this.props.tStart\r\n            this.setState({ t: t * 2 }) // hardcoded 50% speed !\r\n            requestAnimationFrame( setTime )\r\n        }\r\n        requestAnimationFrame( setTime )\r\n    }\r\n\r\n    render() {\r\n        const { lyrics, t } = this.state\r\n        if ( !lyrics ) {\r\n            return <div></div>\r\n        }\r\n        \r\n        // Find first line to show.\r\n        const firstShownLine = lyrics.slice().reverse().find(line => line.start < t)\r\n        if ( !firstShownLine ) {\r\n            return <div></div>\r\n        }\r\n        const lines = [\r\n            firstShownLine\r\n        ]\r\n        if ( lyrics.indexOf( firstShownLine ) < lyrics.length - 1 ) {\r\n            lines.push( lyrics[lyrics.indexOf( firstShownLine ) + 1] )\r\n        }\r\n        return <div className='lines-div'>\r\n            {lines.map(( line, i ) => {\r\n                const refRecord = line.records.find(record =>\r\n                    record.delta + line.start - 1500 >= t    \r\n                )\r\n                return <div className='lyrics-line-div'>\r\n                    <span className='lyrics-line'>{ line.text }\r\n                        <div className='lyrics-highlight'\r\n                            style={{\r\n                                width: refRecord && line === firstShownLine ?\r\n                                    `${100 * refRecord.index / line.text.length}%` :\r\n                                    '0px'\r\n                            }}\r\n                        ></div>\r\n                    </span>\r\n                </div>\r\n            })}\r\n        </div>\r\n    }\r\n\r\n}","import * as React from \"react\";\r\nimport { Button, Layout, Typography, Icon, Input, Affix, Tag } from \"antd/lib\"\r\nconst { Title, Text } = Typography\r\nimport { Loading } from '../Common/Loading'\r\nimport { ApplicationState, Result } from \"../../interfaces\";\r\nimport { Flag } from '../Common/Flag'\r\nimport { playAudioStream, readAudioStream, audio } from \"../../audio\";\r\nimport { SoundOutlined } from '@ant-design/icons'\r\nimport { LyricsComponent } from '../Lyrics'\r\n\r\nconst SERVER_ADDRESS = `${process.env.REACT_APP_SERVER_IP}:${process.env.REACT_APP_SERVER_PORT ? process.env.REACT_APP_SERVER_PORT : ''}`\r\nconsole.log( SERVER_ADDRESS )\r\n\r\ninterface Props {}\r\ninterface State {\r\n    serverState: 'loading' | 'offline' | 'online',\r\n    applicationState: undefined | ApplicationState,\r\n    unsupportedLanguageCodes: undefined | string[]\r\n    bgAudioStart?: number,\r\n    t: number\r\n}\r\nexport class MainMenu extends React.Component<Props, State> {\r\n    refSoumah: React.RefObject<HTMLImageElement>\r\n    audioReady: boolean = false\r\n    bgAudio: HTMLAudioElement = new Audio()\r\n    pointerLocation?: { x: number, y: number }\r\n    constructor( props: Props ) {\r\n        super( props )\r\n        this.connect()\r\n        this.refSoumah = React.createRef()\r\n        const check = () => {\r\n            if ( this.state.bgAudioStart === undefined && this.bgAudio.currentTime > 0 ) {\r\n                this.setState({\r\n                    bgAudioStart: window.performance.now()\r\n                })\r\n            }\r\n            this.setState({\r\n                t: window.performance.now()\r\n            })\r\n            requestAnimationFrame(check)\r\n        }\r\n        requestAnimationFrame(check)\r\n        this.bgAudio.addEventListener( 'canplay', ()  => {\r\n            this.audioReady = true\r\n            // this.bgAudio.currentTime = 3 * 60 + 45\r\n        })\r\n        this.bgAudio.addEventListener( 'ended', () => {\r\n            this.setState({\r\n                bgAudioStart: undefined\r\n            })\r\n        } )\r\n        this.bgAudio.src = 'tamouya_gouli.mp3'\r\n        \r\n        this.state = {\r\n            serverState: 'loading',\r\n            applicationState: undefined,\r\n            unsupportedLanguageCodes: undefined,\r\n            t: window.performance.now()\r\n        }\r\n    }\r\n    handleServerError = ( e: Error ) => {\r\n        console.error( e )\r\n        console.log( 'Server offline?' )\r\n        this.setState({ serverState: 'offline' })\r\n    }\r\n    connect() {\r\n        // Check if server is running.\r\n        fetch(\r\n            SERVER_ADDRESS + '/u-there',\r\n            { mode: 'cors' }\r\n        )\r\n            .then( r => r.text() )\r\n            .then( response => {\r\n                // Check expected response.\r\n                if ( response === 'we here' ) {\r\n                    console.log( 'Server online' )\r\n                    this.setState({ serverState: 'online' })\r\n                    // Get active results if any from server.\r\n                    this.getApplicationState()\r\n                }\r\n            } )\r\n            .catch( this.handleServerError )\r\n    }\r\n    getApplicationState() {\r\n        fetch(\r\n            SERVER_ADDRESS + '/state',\r\n            { mode: 'cors' }\r\n        )\r\n            .then( r => r.json() )\r\n            .then( applicationState => {\r\n                this.setState({ applicationState })\r\n                this.sortUnsupportedTextToSpeech()\r\n            } )\r\n            .catch( this.handleServerError )\r\n    }\r\n    sortUnsupportedTextToSpeech() {\r\n        fetch(\r\n            SERVER_ADDRESS + '/unsupported-languages-text-to-speech',\r\n            { mode: 'cors' }\r\n        )\r\n            .then( r => r.json() )\r\n            .then( ( unsupportedLanguages: { languageCode: string }[] ) => {\r\n                console.log(unsupportedLanguages)\r\n                this.setState({\r\n                    unsupportedLanguageCodes: unsupportedLanguages.map( obj => obj.languageCode )\r\n                })\r\n            } )\r\n            .catch( this.handleServerError )\r\n    }\r\n    first = true\r\n    onAnyClick = () => {\r\n        // Hack - iPhone restricts playing audio that is not based on user interaction.\r\n        // Audio.play() must be called (once for element) directly in event handler for it to work.\r\n        if (this.first) {\r\n            audio.play()\r\n            this.bgAudio.play()\r\n            this.first = false\r\n        }\r\n    }\r\n    playResultSound( result: Result ) {\r\n        this.onAnyClick()\r\n\r\n        fetch(\r\n            SERVER_ADDRESS + `/text-to-speech?text=${result.local}&languageCode=${result.language.Code}`\r\n        )\r\n            .then( readAudioStream)\r\n            .then( playAudioStream )\r\n            .catch( e => {\r\n                console.error( e )\r\n            })\r\n    }\r\n    componentDidMount() {\r\n        // MLG animations.\r\n        const animate = ( ) => {\r\n            requestAnimationFrame( animate )\r\n            // Check music playing.\r\n            if ( this.state.bgAudioStart !== undefined && !tStart ) {\r\n                // start animation.\r\n                tStart = window.performance.now()\r\n            }\r\n\r\n            // const soumah = this.refSoumah.current\r\n            const objects = document.getElementsByClassName('soumah')\r\n            // if ( soumah ) {\r\n            for ( let i = 0; i < objects.length; i ++ ) {\r\n                const soumah = objects[i] as any\r\n                const attr_index = soumah.getAttribute('index')\r\n                const attr_scale = soumah.getAttribute('scale')\r\n                const t = tStart ? 2 * ((window.performance.now( ) + attr_index * 1500) - tStart) / 1000 : 0\r\n\r\n                let rotateX: number = 0\r\n                let rotateY: number = 0\r\n                let rotateZ: number = -10 + Math.sin( t ) * 5\r\n                let skewX: number = 0\r\n                let skewY: number = Math.sin( t ) * 12\r\n                let scale: number = 1 + Math.sin( t * 2 ) * .15\r\n                let translateX: number = -90 + Math.sin( t ) * 150\r\n                let translateY: number = 50 + Math.abs( Math.sin( t ) ) * 100\r\n\r\n                let transform = ``\r\n                transform += `translateX(${translateX}px) translateY(${translateY}px) `\r\n                transform += `skewX(${skewX}deg) skewY(${skewY}deg) `\r\n                transform += `rotateX(${rotateX}deg) rotateY(${rotateY}deg) rotateZ(${rotateZ}deg) ` \r\n                transform += `scaleX(${scale}) scaleY(${scale}) `\r\n                if ( attr_scale )\r\n                    transform += `scaleX(${attr_scale}) scaleY(${attr_scale}) `\r\n                if ( 'src' in soumah && soumah.src.includes( 'eye.png' ) ) {\r\n                    let addX = 0\r\n                    let addY = 0\r\n                    const isLeft = soumah.src.includes( 'leye.png' )\r\n                    const ang = Math.PI * ( rotateZ + 100 ) / 180\r\n                    const ref = {\r\n                        x: window.innerWidth * .5 + 10 * (isLeft ? 1 : -1) - Math.cos(ang) * soumah.width,\r\n                        y: window.innerHeight - Math.sin(ang) * soumah.height * .7\r\n                    }\r\n                    // console.log(ref, '->', this.pointerLocation) 230 161\r\n                    if ( this.pointerLocation ) {\r\n                        const delta = {\r\n                            x: this.pointerLocation.x - ref.x,\r\n                            y: this.pointerLocation.y - ref.y\r\n                        }\r\n                        const dist = Math.sqrt( Math.pow( delta.x, 2 ) + Math.pow( delta.y, 2 ) )\r\n                        const eyeOffset = Math.min( Math.sqrt( dist ) * 1.0, 5 )\r\n                        const deltaAng = Math.atan2(this.pointerLocation.y - ref.y, this.pointerLocation.x - ref.x)\r\n                        const eyeOffsetX = Math.cos( deltaAng ) * eyeOffset\r\n                        const eyeOffsetY = Math.sin( deltaAng ) * eyeOffset\r\n                        addX = eyeOffsetX\r\n                        addY = eyeOffsetY\r\n                    }\r\n\r\n                    transform += `translateX(${addX}px) translateY(${addY}px) `\r\n                }\r\n                soumah.style.transform = transform\r\n            }\r\n        }\r\n        let tStart: number | undefined\r\n        animate()\r\n\r\n        document.addEventListener( 'mousemove', (e) => {\r\n            this.pointerLocation = {\r\n                x: e.clientX,\r\n                y: e.clientY\r\n            }\r\n        }, true )\r\n        document.addEventListener( 'touchmove', (e) => {\r\n            if ( e.changedTouches.length === 0 )\r\n                return\r\n            this.pointerLocation = {\r\n                x: e.changedTouches[0].clientX,\r\n                y: e.changedTouches[0].clientY\r\n            }\r\n        }, true )\r\n    }\r\n    avatars = [\r\n        {\r\n            scale: 1, src: ['momo.png', 'leye.png', 'reye.png']\r\n            // scale: 1, src: ['momo_flute.png']\r\n        }\r\n        // { scale: .6, src: [ 'https://img.pngio.com/donald-trump-united-states-republican-party-face-mask-bill-donald-trump-face-png-1846_2496.png' ] }\r\n    ]\r\n    render() {\r\n        // 3:52 -6:28\r\n        const t = this.state.t\r\n        const isFlute = (this.state.bgAudioStart !== undefined &&\r\n            (t - this.state.bgAudioStart) >= 1000 * (3*60 + 52) &&\r\n            (t - this.state.bgAudioStart) <= 1000 * (5*60 + 34))\r\n\r\n        // 1:57 - 3:00\r\n        const isXylophone = (this.state.bgAudioStart !== undefined &&\r\n            (t - this.state.bgAudioStart) >= 1000 * (1*60 + 57) &&\r\n            (t - this.state.bgAudioStart) <= 1000 * (3*60 + 0))\r\n\r\n        const { serverState } = this.state\r\n        return <div className='expand' onClick={() => this.onAnyClick()}>\r\n            <div className='backgroundDiv' onClick={() => this.onAnyClick()}>\r\n                <img\r\n                    className='background'\r\n                    src='background.png'\r\n                />\r\n                {this.avatars.map((avatar, i) => {\r\n                    const props = { scale: avatar.scale, index: i }\r\n                    return avatar.src.map((url, i2) => <img\r\n                        key={i+'a'+i2}\r\n                        className='soumah'\r\n                        src={(isFlute && url === 'momo.png') ? 'momo_flute.png' : url}\r\n                        {...props}\r\n                        onClick={() => this.onAnyClick()}\r\n                ></img>)\r\n                })}\r\n                {this.state.bgAudioStart && <div className='lyrics-div'>\r\n                    <LyricsComponent\r\n                        lyricsFile='lyrics.json'\r\n                        tStart={this.state.bgAudioStart}\r\n                    />\r\n                </div>}\r\n            </div>\r\n            {isXylophone && this.renderXylophoneStick( t, false )}\r\n            {isXylophone && this.renderXylophoneStick( t, true )}\r\n            {isXylophone && \r\n                <img\r\n                    style={{ position: 'absolute', bottom: 0, right: '35vw' }}\r\n                    src='xylophone.png'\r\n                />\r\n            }\r\n            {serverState === 'loading' ?\r\n                <Loading/> :\r\n                <div className='main'>\r\n                    {serverState === 'offline' ?\r\n                        <Text>Server offline</Text> :\r\n                        this.renderServerOnline()\r\n                    }\r\n                </div>\r\n            }\r\n        </div>\r\n    }\r\n    renderXylophoneStick( t: number, left: boolean ) {\r\n        const cycleDuration = 120\r\n        t = left ? t : t + cycleDuration\r\n        const firstPhase = t % ( cycleDuration * 2 ) <= cycleDuration ? true : false\r\n        let x = ( t % cycleDuration ) / cycleDuration\r\n        if ( !firstPhase ) x = 1 - x\r\n        return <img\r\n            src='xylophone_stick.png'\r\n            className='backgroundElement'\r\n            style={{\r\n                bottom: `${left ? 0 : 60}px`,\r\n                left: `calc(50vw + ${left ? 150: -300}px)`,\r\n                transform: `rotateZ(${ x * (left?-90:90) }deg)`,\r\n                transformOrigin: 'bottom'\r\n            }}\r\n        ></img>\r\n    }\r\n    renderServerOnline() {\r\n        const { applicationState } = this.state\r\n        return <div>\r\n            { applicationState && this.renderApplicationState( applicationState ) }\r\n        </div>\r\n    }\r\n    renderApplicationState( applicationState: ApplicationState ) {\r\n        const { unsupportedLanguageCodes } = this.state\r\n        const { inputLanguage, input, results } = applicationState\r\n        // Sort rendered results so that unsupported languages are last.\r\n        const isResultSupported = ( result: Result ): boolean =>\r\n            unsupportedLanguageCodes === undefined ||\r\n            ! unsupportedLanguageCodes.includes( result.language.Code )\r\n        const sortedResults = results.filter( isResultSupported )\r\n            .concat( results.filter( result => ! isResultSupported( result ) ) )\r\n\r\n        return <div className='column'>\r\n            <Title level={3}>Official translations for...</Title>\r\n            <div className='row listStart'>\r\n                <Text className='speechAsText'>\"{input}\"</Text>\r\n            </div>\r\n            {sortedResults.map(( result, i ) =>\r\n                <div className='row' key={i}>\r\n                    <Text>{result.language.Name}:</Text>\r\n                    <Text className='speechAsText'>{result.local}</Text>\r\n                    {isResultSupported( result ) && <SoundOutlined onClick={() => this.playResultSound( result )} />}\r\n                    { inputLanguage === result.language &&\r\n                        <Text>({result.translation})</Text>\r\n                    }\r\n                </div>\r\n            )}\r\n        </div>\r\n    }\r\n}","import * as React from \"react\";\nimport { render } from \"react-dom\";\nimport { BrowserRouter, Route, Switch } from \"react-router-dom\"\nimport \"./styles.css\";\nimport { MainMenu } from './Components/MainMenu/MainMenu'\nimport { LyricsGenerator } from './Components/LyricsGenerator/LyricsGenerator'\n\ninterface Props {}\ninterface State {}\nclass App extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n        this.state = {}\n    }\n    render() {\n        // return <LyricsGenerator\n        //     audioIn='tamouya_gouli.mp3'\n        //     lyricsIn='lyrics-src.txt'\n        // />\n        return <MainMenu/>\n    }\n}\n\nconst rootElement = document.getElementById(\"root\");\nrender(<App />, rootElement);\n"],"sourceRoot":""}
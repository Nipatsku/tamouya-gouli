{"version":3,"sources":["Components/Common/Loading.tsx","audio.ts","Components/MainMenu/MainMenu.tsx","index.tsx"],"names":["Loading","_React$Component","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","apply","arguments","inherits","createClass","key","value","react","lib","size","className","React","readAudioStream","res","body","getReader","read","then","result","audio","Audio","playAudioStream","blob","Blob","type","url","window","URL","createObjectURL","src","play","Title","Typography","Text","SERVER_ADDRESS","concat","process","REACT_APP_SERVER_PORT","console","log","MainMenu","props","_this","call","refSoumah","handleServerError","e","error","setState","serverState","avatars","scale","connect","state","applicationState","undefined","unsupportedLanguageCodes","_this2","fetch","mode","r","text","response","getApplicationState","catch","_this3","json","sortUnsupportedTextToSpeech","_this4","unsupportedLanguages","map","obj","languageCode","local","language","Code","tStart","performance","now","animate","objects","document","getElementsByClassName","i","length","soumah","attr_index","getAttribute","attr_scale","t","rotateZ","Math","sin","skewY","translateX","translateY","abs","transform","style","requestAnimationFrame","avatar","index","i2","assign","Loading_Loading","renderServerOnline","renderApplicationState","_this5","inputLanguage","input","results","isResultSupported","includes","sortedResults","filter","level","Name","SoundOutlined","onClick","playResultSound","translation","App","MainMenu_MainMenu","rootElement","getElementById","render","src_App"],"mappings":"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","file":"static/js/main.1962571d.chunk.js","sourcesContent":["import * as React from \"react\";\r\nimport { Spin } from \"antd/lib\"\r\n\r\ninterface Props {}\r\ninterface State {}\r\nexport class Loading extends React.Component<Props, State> {\r\n    render() {\r\n        return <Spin\r\n            size=\"large\"\r\n            className=\"absoluteCenter\"\r\n        />\r\n    }\r\n}\r\n","\r\n// https://medium.com/@bitshadow/play-audio-via-react-fetch-post-request-92a901d0bb7f\r\n\r\nexport const readAudioStream = ( res: Response ) => {\r\n    const reader = res.body!.getReader()\r\n    return reader\r\n        .read()\r\n        .then((result) => {\r\n            return result;\r\n        });\r\n}\r\n\r\nexport const audio = new Audio()\r\nexport const playAudioStream = ( res: ReadableStreamReadResult<Uint8Array> ) => {\r\n    const blob = new Blob([res.value!], { type: 'audio/mp3' });\r\n    const url = window.URL.createObjectURL(blob)\r\n    audio.src = url;\r\n    audio.play();\r\n}\r\n","import * as React from \"react\";\r\nimport { Button, Layout, Typography, Icon, Input, Affix, Tag } from \"antd/lib\"\r\nconst { Title, Text } = Typography\r\nimport { Loading } from '../Common/Loading'\r\nimport { ApplicationState, Result } from \"../../interfaces\";\r\nimport { Flag } from '../Common/Flag'\r\nimport { playAudioStream, readAudioStream, audio } from \"../../audio\";\r\nimport { SoundOutlined } from '@ant-design/icons'\r\n\r\nconst SERVER_ADDRESS = `${process.env.REACT_APP_SERVER_IP}:${process.env.REACT_APP_SERVER_PORT ? process.env.REACT_APP_SERVER_PORT : ''}`\r\nconsole.log( SERVER_ADDRESS )\r\n\r\ninterface Props {}\r\ninterface State {\r\n    serverState: 'loading' | 'offline' | 'online',\r\n    applicationState: undefined | ApplicationState,\r\n    unsupportedLanguageCodes: undefined | string[]\r\n}\r\nexport class MainMenu extends React.Component<Props, State> {\r\n    refSoumah: React.RefObject<HTMLImageElement>\r\n    constructor( props: Props ) {\r\n        super( props )\r\n        this.connect()\r\n        this.refSoumah = React.createRef()\r\n        this.state = {\r\n            serverState: 'loading',\r\n            applicationState: undefined,\r\n            unsupportedLanguageCodes: undefined\r\n        }\r\n    }\r\n    handleServerError = ( e: Error ) => {\r\n        console.error( e )\r\n        console.log( 'Server offline?' )\r\n        this.setState({ serverState: 'offline' })\r\n    }\r\n    connect() {\r\n        // Check if server is running.\r\n        fetch(\r\n            SERVER_ADDRESS + '/u-there',\r\n            { mode: 'cors' }\r\n        )\r\n            .then( r => r.text() )\r\n            .then( response => {\r\n                // Check expected response.\r\n                if ( response === 'we here' ) {\r\n                    console.log( 'Server online' )\r\n                    this.setState({ serverState: 'online' })\r\n                    // Get active results if any from server.\r\n                    this.getApplicationState()\r\n                }\r\n            } )\r\n            .catch( this.handleServerError )\r\n    }\r\n    getApplicationState() {\r\n        fetch(\r\n            SERVER_ADDRESS + '/state',\r\n            { mode: 'cors' }\r\n        )\r\n            .then( r => r.json() )\r\n            .then( applicationState => {\r\n                this.setState({ applicationState })\r\n                this.sortUnsupportedTextToSpeech()\r\n            } )\r\n            .catch( this.handleServerError )\r\n    }\r\n    sortUnsupportedTextToSpeech() {\r\n        fetch(\r\n            SERVER_ADDRESS + '/unsupported-languages-text-to-speech',\r\n            { mode: 'cors' }\r\n        )\r\n            .then( r => r.json() )\r\n            .then( ( unsupportedLanguages: { languageCode: string }[] ) => {\r\n                console.log(unsupportedLanguages)\r\n                this.setState({\r\n                    unsupportedLanguageCodes: unsupportedLanguages.map( obj => obj.languageCode )\r\n                })\r\n            } )\r\n            .catch( this.handleServerError )\r\n    }\r\n    playResultSound( result: Result ) {\r\n        // Hack - iPhone restricts playing audio that is not based on user interaction.\r\n        // Audio.play() must be called (once for element) directly in event handler for it to work.\r\n        audio.play()\r\n\r\n        fetch(\r\n            SERVER_ADDRESS + `/text-to-speech?text=${result.local}&languageCode=${result.language.Code}`\r\n        )\r\n            .then( readAudioStream)\r\n            .then( playAudioStream )\r\n            .catch( e => {\r\n                console.error( e )\r\n            })\r\n    }\r\n    componentDidMount() {\r\n        // MLG animations.\r\n        const animate = ( ) => {\r\n            // const soumah = this.refSoumah.current\r\n            const objects = document.getElementsByClassName('soumah')\r\n            // if ( soumah ) {\r\n            for ( let i = 0; i < objects.length; i ++ ) {\r\n                const soumah = objects[i] as any\r\n                const attr_index = soumah.getAttribute('index')\r\n                const attr_scale = soumah.getAttribute('scale')\r\n                const t = 2.0 * ((window.performance.now( ) + attr_index * 1500) - tStart) / 1000\r\n\r\n                let rotateX: number = 0\r\n                let rotateY: number = 0\r\n                let rotateZ: number = -10 + Math.sin( t ) * 5\r\n                let skewX: number = 0\r\n                let skewY: number = Math.sin( t ) * 12\r\n                let scale: number = 1 + Math.sin( t * 2 ) * .15\r\n                let translateX: number = -100 + Math.sin( t ) * 150\r\n                let translateY: number = 40 + Math.abs( Math.sin( t ) ) * 100\r\n\r\n                let transform = ``\r\n                transform += `translateX(${translateX}px) translateY(${translateY}px) `\r\n                transform += `skewX(${skewX}deg) skewY(${skewY}deg) `\r\n                transform += `rotateX(${rotateX}deg) rotateY(${rotateY}deg) rotateZ(${rotateZ}deg) ` \r\n                transform += `scaleX(${scale}) scaleY(${scale}) `\r\n                if ( attr_scale )\r\n                    transform += `scaleX(${attr_scale}) scaleY(${attr_scale}) `\r\n                soumah.style.transform = transform\r\n            }\r\n            requestAnimationFrame( animate )\r\n        }\r\n        const tStart = window.performance.now()\r\n        animate()\r\n    }\r\n    avatars = [\r\n        {\r\n            scale: 1, src: ['wandelsoumah_avatar.png', 'lagus.png']\r\n        },\r\n        // { scale: .6, src: [ 'https://img.pngio.com/donald-trump-united-states-republican-party-face-mask-bill-donald-trump-face-png-1846_2496.png' ] }\r\n    ]\r\n    render() {\r\n        const { serverState } = this.state\r\n        return <div className='expand'>\r\n            <div className='backgroundDiv'>\r\n                <img\r\n                    className='background'\r\n                    src='wandelsoumah_bg.png'\r\n                />\r\n                {this.avatars.map((avatar, i) => {\r\n                    const props = { scale: avatar.scale, index: i }\r\n                    return avatar.src.map((url, i2) => <img\r\n                        key={i+'a'+i2}\r\n                        className='soumah'\r\n                        src={url}\r\n                        {...props}\r\n                ></img>)\r\n                })}\r\n            </div>\r\n            {serverState === 'loading' ?\r\n                <Loading/> :\r\n                <div className='main'>\r\n                    {serverState === 'offline' ?\r\n                        <Text>Server is offline... more \"aamuja\" some other time</Text> :\r\n                        this.renderServerOnline()\r\n                    }\r\n                </div>\r\n            }\r\n        </div>\r\n    }\r\n    renderServerOnline() {\r\n        const { applicationState } = this.state\r\n        return <div>\r\n            { applicationState && this.renderApplicationState( applicationState ) }\r\n        </div>\r\n    }\r\n    renderApplicationState( applicationState: ApplicationState ) {\r\n        const { unsupportedLanguageCodes } = this.state\r\n        const { inputLanguage, input, results } = applicationState\r\n        // Sort rendered results so that unsupported languages are last.\r\n        const isResultSupported = ( result: Result ): boolean =>\r\n            unsupportedLanguageCodes === undefined ||\r\n            ! unsupportedLanguageCodes.includes( result.language.Code )\r\n        const sortedResults = results.filter( isResultSupported )\r\n            .concat( results.filter( result => ! isResultSupported( result ) ) )\r\n\r\n        return <div className='column'>\r\n            <Title level={3}>Official translations for...</Title>\r\n            <div className='row listStart'>\r\n                <Text className='speechAsText'>\"{input}\"</Text>\r\n            </div>\r\n            {sortedResults.map(( result, i ) =>\r\n                <div className='row' key={i}>\r\n                    <Text>{result.language.Name}:</Text>\r\n                    <Text className='speechAsText'>{result.local}</Text>\r\n                    {isResultSupported( result ) && <SoundOutlined onClick={() => this.playResultSound( result )} />}\r\n                    { inputLanguage === result.language &&\r\n                        <Text>({result.translation})</Text>\r\n                    }\r\n                </div>\r\n            )}\r\n        </div>\r\n    }\r\n}","import * as React from \"react\";\nimport { render } from \"react-dom\";\nimport { BrowserRouter, Route, Switch } from \"react-router-dom\"\nimport \"./styles.css\";\nimport { MainMenu } from './Components/MainMenu/MainMenu'\n\ninterface Props {}\ninterface State {}\nclass App extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n        this.state = {}\n    }\n    render() {\n        return <MainMenu/>\n    }\n}\n\nconst rootElement = document.getElementById(\"root\");\nrender(<App />, rootElement);\n"],"sourceRoot":""}
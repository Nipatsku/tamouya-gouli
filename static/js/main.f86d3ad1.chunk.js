(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{375:function(e,t,n){e.exports=n(896)},380:function(e,t,n){},896:function(e,t,n){"use strict";n.r(t);var a=n(64),r=n(65),c=n(67),o=n(66),i=n(68),l=n(1),s=n.n(l),u=n(7),d=(n(380),n(116)),m=function(e){function t(){return Object(a.a)(this,t),Object(c.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(i.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return l.createElement(d.Spin,{size:"large",className:"absoluteCenter"})}}]),t}(l.Component),p=function(e){return e.body.getReader().read().then(function(e){return e})},f=new Audio,h=function(e){var t=new Blob([e.value],{type:"audio/mp3"}),n=window.URL.createObjectURL(t);f.src=n,f.play()},v=n(907),g=function(e){function t(e){var n;return Object(a.a)(this,t),n=Object(c.a)(this,Object(o.a)(t).call(this,e)),fetch(n.props.lyricsFile).then(function(e){return e.json()}).then(function(e){n.setState({lyrics:e}),console.log(e)}),n.state={lyrics:void 0,t:0},n}return Object(i.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;requestAnimationFrame(function t(){var n=window.performance.now()-e.props.tStart;e.setState({t:2*n}),requestAnimationFrame(t)})}},{key:"render",value:function(){var e=this.state,t=e.lyrics,n=e.t;if(!t)return s.a.createElement("div",null);var a=t.slice().reverse().find(function(e){return e.start<n});if(!a)return s.a.createElement("div",null);var r=[a];return t.indexOf(a)<t.length-1&&r.push(t[t.indexOf(a)+1]),s.a.createElement("div",{className:"lines-div"},r.map(function(e,t){var r=e.records.find(function(t){return t.delta+e.start-1500>=n});return s.a.createElement("div",{className:"lyrics-line-div"},s.a.createElement("span",{className:"lyrics-line"},e.text,s.a.createElement("div",{className:"lyrics-highlight",style:{width:r&&e===a?"".concat(100*r.index/e.text.length,"%"):"0px"}})))}))}}]),t}(s.a.Component),y=d.Typography.Title,E=d.Typography.Text,b="".concat("https://0c21e816.ngrok.io",":").concat(Object({NODE_ENV:"production",PUBLIC_URL:"/tamouya-gouli",REACT_APP_SERVER_IP:"https://0c21e816.ngrok.io"}).REACT_APP_SERVER_PORT?Object({NODE_ENV:"production",PUBLIC_URL:"/tamouya-gouli",REACT_APP_SERVER_IP:"https://0c21e816.ngrok.io"}).REACT_APP_SERVER_PORT:"");console.log(b);var S=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(o.a)(t).call(this,e))).refSoumah=void 0,n.bgAudioStart=void 0,n.bgAudio=new Audio("tamouya_gouli.mp3"),n.handleServerError=function(e){console.error(e),console.log("Server offline?"),n.setState({serverState:"offline"})},n.first=!0,n.onAnyClick=function(){n.first&&(f.play(),n.bgAudio.play(),n.first=!1)},n.avatars=[{scale:1,src:["momo.png","merkit.png","baretti.png"]}],n.connect(),n.refSoumah=l.createRef(),n.bgAudio.addEventListener("play",function(){console.log("play"),n.bgAudioStart=window.performance.now()}),n.bgAudio.play(),n.state={serverState:"loading",applicationState:void 0,unsupportedLanguageCodes:void 0},n}return Object(i.a)(t,e),Object(r.a)(t,[{key:"connect",value:function(){var e=this;fetch(b+"/u-there",{mode:"cors"}).then(function(e){return e.text()}).then(function(t){"we here"===t&&(console.log("Server online"),e.setState({serverState:"online"}),e.getApplicationState())}).catch(this.handleServerError)}},{key:"getApplicationState",value:function(){var e=this;fetch(b+"/state",{mode:"cors"}).then(function(e){return e.json()}).then(function(t){e.setState({applicationState:t}),e.sortUnsupportedTextToSpeech()}).catch(this.handleServerError)}},{key:"sortUnsupportedTextToSpeech",value:function(){var e=this;fetch(b+"/unsupported-languages-text-to-speech",{mode:"cors"}).then(function(e){return e.json()}).then(function(t){console.log(t),e.setState({unsupportedLanguageCodes:t.map(function(e){return e.languageCode})})}).catch(this.handleServerError)}},{key:"playResultSound",value:function(e){this.onAnyClick(),fetch(b+"/text-to-speech?text=".concat(e.local,"&languageCode=").concat(e.language.Code)).then(p).then(h).catch(function(e){console.error(e)})}},{key:"componentDidMount",value:function(){var e=window.performance.now();!function t(){for(var n=document.getElementsByClassName("soumah"),a=0;a<n.length;a++){var r=n[a],c=r.getAttribute("index"),o=r.getAttribute("scale"),i=2*(window.performance.now()+1500*c-e)/1e3,l=5*Math.sin(i)-10,s=12*Math.sin(i),u=1+.15*Math.sin(2*i),d=150*Math.sin(i)-100,m=40+100*Math.abs(Math.sin(i)),p="";p+="translateX(".concat(d,"px) translateY(").concat(m,"px) "),p+="skewX(".concat(0,"deg) skewY(").concat(s,"deg) "),p+="rotateX(".concat(0,"deg) rotateY(").concat(0,"deg) rotateZ(").concat(l,"deg) "),p+="scaleX(".concat(u,") scaleY(").concat(u,") "),o&&(p+="scaleX(".concat(o,") scaleY(").concat(o,") ")),r.style.transform=p}requestAnimationFrame(t)}()}},{key:"render",value:function(){var e=this,t=this.state.serverState;return l.createElement("div",{className:"expand",onClick:function(){return e.onAnyClick()}},l.createElement("div",{className:"backgroundDiv",onClick:function(){return e.onAnyClick()}},l.createElement("img",{onClick:function(){return e.onAnyClick()},className:"background",src:"wandelsoumah_bg.png"}),l.createElement("span",{className:"hint"},"If music is not playing, click somewhere"),this.avatars.map(function(t,n){var a={scale:t.scale,index:n};return t.src.map(function(t,r){return l.createElement("img",Object.assign({key:n+"a"+r,className:"soumah",src:t},a,{onClick:function(){return e.onAnyClick()}}))})}),this.bgAudioStart&&l.createElement("div",{className:"lyrics-div"},l.createElement(g,{lyricsFile:"lyrics.json",tStart:this.bgAudioStart}))),"loading"===t?l.createElement(m,null):l.createElement("div",{className:"main"},"offline"===t?l.createElement(E,null,'Server is offline... more "aamuja" some other time'):this.renderServerOnline()))}},{key:"renderServerOnline",value:function(){var e=this.state.applicationState;return l.createElement("div",null,e&&this.renderApplicationState(e))}},{key:"renderApplicationState",value:function(e){var t=this,n=this.state.unsupportedLanguageCodes,a=e.inputLanguage,r=e.input,c=e.results,o=function(e){return void 0===n||!n.includes(e.language.Code)},i=c.filter(o).concat(c.filter(function(e){return!o(e)}));return l.createElement("div",{className:"column"},l.createElement(y,{level:3},"Official translations for..."),l.createElement("div",{className:"row listStart"},l.createElement(E,{className:"speechAsText"},'"',r,'"')),i.map(function(e,n){return l.createElement("div",{className:"row",key:n},l.createElement(E,null,e.language.Name,":"),l.createElement(E,{className:"speechAsText"},e.local),o(e)&&l.createElement(v.a,{onClick:function(){return t.playResultSound(e)}}),a===e.language&&l.createElement(E,null,"(",e.translation,")"))}))}}]),t}(l.Component),k=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(o.a)(t).call(this,e))).state={},n}return Object(i.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return l.createElement(S,null)}}]),t}(l.Component),A=document.getElementById("root");Object(u.render)(l.createElement(k,null),A)}},[[375,2,1]]]);
//# sourceMappingURL=main.f86d3ad1.chunk.js.map